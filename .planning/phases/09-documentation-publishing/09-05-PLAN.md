---
phase: 09-documentation-publishing
plan: 05
type: execute
wave: 1
depends_on: []
files_modified:
  - docs/deployment.md
  - docs/cardano-x402.md
autonomous: true

must_haves:
  truths:
    - "Deployment guide covers Docker production setup, testnet configuration, and environment-specific settings"
    - "Positioning document explains why Cardano for x402 and how it complements EVM L2s"
  artifacts:
    - path: "docs/deployment.md"
      provides: "Complete deployment guide with Docker, config, and testnet setup"
      min_lines: 80
      contains: "docker compose"
    - path: "docs/cardano-x402.md"
      provides: "Cardano x402 positioning document"
      min_lines: 60
      contains: "high-value"
  key_links:
    - from: "docs/deployment.md"
      to: "config/config.example.json"
      via: "references config example"
      pattern: "config.example"
    - from: "docs/deployment.md"
      to: "docs/operations.md"
      via: "links to operational runbook"
      pattern: "operations"
---

<objective>
Create docs/deployment.md (consolidated deployment guide) and docs/cardano-x402.md (positioning document explaining why Cardano for x402).

Purpose: Deployment guide enables production deployment. Positioning document communicates the project's strategic rationale to potential users and contributors.
Output: Two new docs/ files.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/09-documentation-publishing/09-RESEARCH.md

@docs/operations.md
@config/config.example.json
@Dockerfile
@docker-compose.yml
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create deployment guide</name>
  <files>docs/deployment.md</files>
  <action>
Create `docs/deployment.md` with comprehensive deployment instructions. This consolidates Docker deployment, configuration, and testnet setup into one guide. It should NOT duplicate the operations runbook (`docs/operations.md`) but should link to it.

Structure:

```markdown
# Deployment Guide

## Overview

Deployment options for the x402 Cardano Payment Facilitator.

## Prerequisites

- Docker and Docker Compose (for containerized deployment)
- OR Node.js 20+ and pnpm (for bare metal)
- Blockfrost API key (https://blockfrost.io)
- Funded Cardano wallet (24-word seed phrase)
- Redis 7+ (provided via Docker or external)

## Configuration

### Config File

The facilitator reads configuration from `config/config.json` (Zod-validated at startup).

Copy the example: `cp config/config.example.json config/config.json`

### Required Settings

Table of required config fields:
| Field | Description | Example |
|-------|-------------|---------|
| chain.network | Cardano network | "Preview", "Preprod", "Mainnet" |
| chain.blockfrost.projectId | Blockfrost API key | "previewXXX..." |
| chain.facilitator.seedPhrase | 24-word wallet seed | "word1 word2 ..." |
| chain.redis.host | Redis hostname | "localhost" or "redis-prod" |

### Optional Settings

Table of optional config fields with defaults:
| Field | Default | Description |
|-------|---------|-------------|
| server.port | 3000 | HTTP port |
| logging.level | "info" | Log level |
| logging.pretty | false | Pretty-print logs |
| rateLimit.global | 100 | Requests/min global |
| rateLimit.sensitive | 20 | Requests/min for verify/settle/status |
| storage.backend | "fs" | "fs" or "ipfs" |

### Testnet Setup

Step-by-step for Cardano Preview testnet:
1. Create a Blockfrost account at blockfrost.io
2. Create a project for "Cardano Preview" network
3. Copy the project ID into config
4. Generate or use an existing 24-word seed phrase
5. Fund the wallet via the Cardano Testnet Faucet (https://docs.cardano.org/cardano-testnets/tools/faucet/)
6. Need at least 10 ADA for facilitator operations

### Mainnet Safety

The facilitator requires `MAINNET=true` environment variable to connect to mainnet. This is a safety guardrail to prevent accidental mainnet usage during development.

## Docker Deployment (Recommended)

### Development

```bash
# Start Redis only
docker compose up -d

# Run facilitator locally with hot reload
pnpm dev
```

### Production

Step-by-step:
1. Create config/config.json with production values (env: "production", logging.pretty: false, redis host: "redis-prod")
2. Set Redis password: `export REDIS_PASSWORD=your-secure-password`
3. Start: `docker compose --profile production up -d`
4. Verify: `curl http://localhost:3000/health`

Docker Compose services:
| Profile | Service | Port | Description |
|---------|---------|------|-------------|
| (default) | redis | 6379 | Dev Redis (no auth) |
| production | x402-facilitator | 3000 | Facilitator server |
| production | redis-prod | 6380 | Production Redis (with auth) |

### Custom Docker Build

```bash
docker build -t x402-fac .
docker run -p 3000:3000 -v ./config:/app/config:ro x402-fac
```

Image details: Alpine-based, non-root user (appuser:1001), ~180MB.

## Bare Metal Deployment

```bash
pnpm install --frozen-lockfile
pnpm build
node dist/index.js
```

Requires external Redis. Set config.chain.redis.host to your Redis instance.

## Monitoring

Link to [Operations Runbook](operations.md) for:
- Health check monitoring
- Log analysis
- Sentry error tracking
- Redis monitoring
- Common issues and recovery

## Security Considerations

- Config file contains secrets (API keys, seed phrase) -- never commit to git
- Use bind-mounted config in Docker (`:ro` flag)
- Enable Redis authentication in production
- Rate limiting configured by default
- Run Docker container as non-root (handled automatically)
- See [SECURITY.md](../SECURITY.md) for vulnerability reporting
```

Approximately 120-180 lines. Reference but don't duplicate the operations runbook.
  </action>
  <verify>`docs/deployment.md` exists. Contains Docker and bare metal sections. Contains testnet setup instructions. References config.example.json.</verify>
  <done>Deployment guide covers Docker, bare metal, configuration, and testnet setup.</done>
</task>

<task type="auto">
  <name>Task 2: Create Cardano x402 positioning document</name>
  <files>docs/cardano-x402.md</files>
  <action>
Create `docs/cardano-x402.md` explaining why Cardano for x402 and how it complements EVM L2 micropayments.

Structure:

```markdown
# Cardano x402: High-Value Payment Operations

## The x402 Protocol

Brief: x402 is an HTTP-native payment protocol using HTTP 402 Payment Required. It enables machine-to-machine payments where services are paid for per-request. The protocol is chain-agnostic -- different blockchains serve different price tiers.

## Why Cardano?

### High-Value Operations (>= 1 ADA)

Cardano's minimum UTXO requirement (~1 ADA) makes it naturally suited for operations worth paying for:
- AI agent tasks (inference, training, tool use)
- Document processing and analysis
- File storage and retrieval
- Compute-on-demand
- Data API access

This isn't a limitation -- it's market positioning. Operations below ~$0.30 should use EVM L2s.

### EUTXO Model

Cardano's Extended UTXO model provides:
- **Inherent replay protection** -- each UTXO can only be spent once, no nonce tracking needed
- **Deterministic fees** -- fees calculated before submission, no gas estimation guessing
- **Parallel transaction processing** -- different UTXOs can be consumed concurrently

### Multi-Asset Native

Cardano supports multiple tokens natively at the protocol level:
- ADA (native token)
- Stablecoins: USDM, DJED, iUSD
- Custom tokens via policy IDs
- No smart contract needed for simple transfers

### Transaction-Based Verification

Unlike signature-based verification (COSE/CIP-8), this facilitator uses transaction-based verification:
- Client builds and signs a complete Cardano transaction
- Facilitator deserializes CBOR and verifies outputs
- 10-check verification pipeline catches all categories of invalid transactions
- Same transaction is submitted for settlement (no second signing step)

## Complementing EVM L2 Micropayments

The x402 ecosystem spans multiple chains at different price tiers:

| Chain | Price Tier | Use Cases | Settlement Time |
|-------|-----------|-----------|-----------------|
| Base, Optimism | Sub-cent (<$0.01) | Per-token LLM inference, API calls | ~2s |
| Ethereum L2s | Cents ($0.01-$0.30) | Medium-value operations | ~2-10s |
| **Cardano** | **$0.30+ (>= 1 ADA)** | **High-value operations** | **~20s (1 block)** |

These are complementary, not competing. A resource server could support both:
- Cheap operations gated by Base (via Coinbase x402)
- Expensive operations gated by Cardano (via this facilitator)

## Architecture

Link to [Architecture Diagrams](architecture.md) for detailed system documentation.

## Getting Started

Link to [README](../README.md) for quick start guide.
```

Approximately 80-120 lines. Focus on positioning and rationale, not implementation details. This document helps potential users and contributors understand WHY this project exists and WHERE it fits in the x402 ecosystem.
  </action>
  <verify>`docs/cardano-x402.md` exists. Contains "high-value" positioning. Contains EVM L2 comparison table. No real API keys or secrets.</verify>
  <done>Positioning document explains Cardano's role in x402 ecosystem and complementary relationship with EVM L2s.</done>
</task>

</tasks>

<verification>
1. `docs/deployment.md` exists with Docker + bare metal + testnet setup
2. `docs/cardano-x402.md` exists with positioning rationale
3. Both files reference related docs (links work)
4. No sensitive information in either file
</verification>

<success_criteria>
- Deployment guide enables production deployment from scratch
- Positioning document communicates the "why Cardano" rationale clearly
- Both documents are self-contained yet link to related resources
</success_criteria>

<output>
After completion, create `.planning/phases/09-documentation-publishing/09-05-SUMMARY.md`
</output>
