---
phase: 01-foundation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - package.json
  - pnpm-lock.yaml
  - tsconfig.json
  - tsdown.config.ts
  - eslint.config.js
  - .prettierrc
  - .prettierignore
  - .husky/pre-commit
  - src/index.ts
  - src/types/index.ts
autonomous: true

must_haves:
  truths:
    - "pnpm install completes without errors"
    - "pnpm build compiles TypeScript to dist/"
    - "pnpm lint runs ESLint without configuration errors"
    - "Pre-commit hook blocks commits with lint errors"
  artifacts:
    - path: "package.json"
      provides: "Project manifest with all dependencies"
      contains: "fastify"
    - path: "tsconfig.json"
      provides: "TypeScript configuration"
      contains: "strict"
    - path: "tsdown.config.ts"
      provides: "Build configuration"
      contains: "entry"
    - path: "eslint.config.js"
      provides: "ESLint flat config with Airbnb rules"
      contains: "airbnb"
    - path: ".husky/pre-commit"
      provides: "Git pre-commit hook"
      contains: "lint-staged"
  key_links:
    - from: "package.json"
      to: "tsconfig.json"
      via: "build script references"
      pattern: "tsc|tsdown"
    - from: ".husky/pre-commit"
      to: "package.json"
      via: "lint-staged command"
      pattern: "lint-staged"
---

<objective>
Bootstrap the x402-fac project with TypeScript, build tooling, and code quality infrastructure.

Purpose: Establish the foundational project structure that all subsequent work builds upon. Without this, no code can be written, built, or validated.

Output: A working TypeScript project with pnpm, tsdown builds, ESLint/Prettier formatting, and husky pre-commit hooks.
</objective>

<execution_context>
@/Users/morgan/.claude/get-shit-done/workflows/execute-plan.md
@/Users/morgan/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/01-foundation/01-CONTEXT.md
@.planning/phases/01-foundation/01-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Initialize pnpm project and install dependencies</name>
  <files>
    package.json
    pnpm-lock.yaml
    src/index.ts
    src/types/index.ts
  </files>
  <action>
    1. Run `pnpm init` to create package.json
    2. Configure package.json with:
       - name: "x402-fac"
       - type: "module" (ESM)
       - main: "dist/index.js"
       - engines: { "node": ">=20" }
       - scripts: dev, build, lint, typecheck, test, prepare
    3. Install production dependencies:
       `pnpm add fastify zod pino @fastify/helmet @fastify/cors @fastify/error @sentry/node`
    4. Install dev dependencies:
       `pnpm add -D typescript tsx vitest @vitest/coverage-v8 tsdown pino-pretty husky lint-staged eslint prettier eslint-config-airbnb-extended @types/node`
    5. Create directory structure:
       - src/ (source code)
       - src/types/ (TypeScript types)
       - tests/ (test files)
       - tests/unit/
       - tests/integration/
       - config/ (config examples)
    6. Create placeholder src/index.ts with:
       ```typescript
       console.log('x402-fac starting...');
       ```
    7. Create src/types/index.ts with empty export
  </action>
  <verify>
    - `pnpm install` succeeds
    - `ls src/` shows index.ts and types/
    - `ls tests/` shows unit/ and integration/
    - package.json has "type": "module"
  </verify>
  <done>
    Package.json exists with all dependencies, directory structure created, pnpm-lock.yaml generated.
  </done>
</task>

<task type="auto">
  <name>Task 2: Configure TypeScript and tsdown build</name>
  <files>
    tsconfig.json
    tsdown.config.ts
  </files>
  <action>
    1. Create tsconfig.json per RESEARCH.md pattern:
       - target: ES2022
       - module: ESNext
       - moduleResolution: bundler
       - strict: true (mandatory)
       - esModuleInterop: true
       - skipLibCheck: true
       - forceConsistentCasingInFileNames: true
       - declaration: true
       - declarationMap: true
       - sourceMap: true
       - outDir: ./dist
       - rootDir: ./src
       - paths: { "@/*": ["./src/*"] }
       - include: ["src/**/*"]
       - exclude: ["node_modules", "dist", "tests"]

    2. Create tsdown.config.ts:
       ```typescript
       import { defineConfig } from 'tsdown';

       export default defineConfig({
         entry: ['./src/index.ts'],
         format: ['esm'],
         dts: true,
         clean: true,
         sourcemap: true,
       });
       ```

    3. Update package.json scripts:
       - "build": "tsdown"
       - "typecheck": "tsc --noEmit"
  </action>
  <verify>
    - `pnpm typecheck` passes (no type errors)
    - `pnpm build` creates dist/index.js
    - dist/ contains .js, .d.ts, and .map files
  </verify>
  <done>
    TypeScript compiles successfully with strict mode. Build outputs ESM format to dist/.
  </done>
</task>

<task type="auto">
  <name>Task 3: Setup ESLint + Prettier + husky + lint-staged</name>
  <files>
    eslint.config.js
    .prettierrc
    .prettierignore
    .husky/pre-commit
  </files>
  <action>
    1. Create eslint.config.js using flat config format:
       - Extend eslint-config-airbnb-extended
       - Enable TypeScript parsing
       - Configure import organization per CONTEXT.md:
         - External packages first
         - Internal modules (@/*)
         - Relative imports
       - Ignore dist/, node_modules/

    2. Create .prettierrc:
       ```json
       {
         "semi": true,
         "singleQuote": true,
         "trailingComma": "es5",
         "tabWidth": 2,
         "printWidth": 100
       }
       ```
       Note: Semi=true follows Airbnb defaults per CONTEXT.md

    3. Create .prettierignore:
       ```
       dist/
       node_modules/
       pnpm-lock.yaml
       coverage/
       ```

    4. Initialize husky: `pnpm exec husky init`

    5. Create .husky/pre-commit:
       ```bash
       pnpm lint-staged
       pnpm typecheck
       ```

    6. Add lint-staged config to package.json:
       ```json
       "lint-staged": {
         "*.ts": [
           "eslint --fix",
           "prettier --write"
         ]
       }
       ```

    7. Update package.json scripts:
       - "lint": "eslint src tests"
       - "lint:fix": "eslint src tests --fix"
       - "format": "prettier --write src tests"
       - "prepare": "husky"
  </action>
  <verify>
    - `pnpm lint` runs without configuration errors
    - `pnpm format` formats files
    - Create a test commit with a lint error and verify hook blocks it
    - Fix the error and verify commit succeeds
  </verify>
  <done>
    ESLint runs with Airbnb rules, Prettier formats code, pre-commit hook runs lint-staged and typecheck.
  </done>
</task>

</tasks>

<verification>
After all tasks complete:

1. `pnpm install && pnpm build` - must succeed with zero errors
2. `pnpm lint` - must pass with zero violations (or only warnings on placeholder files)
3. `pnpm typecheck` - must pass with zero errors
4. `git add . && git commit -m "test"` - hook should run lint-staged and typecheck
5. `ls dist/` - must contain index.js, index.d.ts
</verification>

<success_criteria>
- Package.json has all required dependencies
- TypeScript strict mode enabled and compiling
- Build produces ESM output in dist/
- ESLint configured with Airbnb rules
- Prettier configured with semicolons (Airbnb default)
- Pre-commit hook blocks bad commits
- Directory structure: src/, tests/unit/, tests/integration/, config/
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation/01-01-SUMMARY.md`
</output>
